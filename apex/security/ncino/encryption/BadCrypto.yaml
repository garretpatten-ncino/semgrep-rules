rules:
  - id: apex.encryption.bad-crypto
    severity: ERROR
    languages:
      - apex
    metadata:
      cwe:
      - CWE-321 Use of Hard-coded Cryptographic Key https://cwe.mitre.org/data/definitions/321.html
      category: security
      subcategory: encryption
      technology: ncino
    message: >-
      The rule makes sure you are using randomly generated IVs and keys
      for Crypto calls. Hard-coding these values greatly compromises the
      security of encrypted data.
    pattern-either:
      - pattern: Blob $IV = Blob.valueOf('$STRING');...Crypto.encrypt($ONE, $TWO, $IV, $FOUR);
      - pattern: Blob $IV = Blob.valueOf('$STRING');...Crypto.decrypt($ONE, $TWO, $IV, $FOUR);
      - pattern: Blob $KEY = Blob.valueOf('$STRING');...Crypto.encrypt($ONE, $KEY, $THREE, $FOUR);
      - pattern: Blob $KEY = Blob.valueOf('$STRING');...Crypto.decrypt($ONE, $KEY, $THREE, $FOUR);
    paths:
      exclude:
        - "*Test*"
        - "*test*"
