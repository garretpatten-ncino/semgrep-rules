rules:
  - id: apex.dml.apex-csrf-static-constructor
    severity: ERROR
    languages:
      - generic
    metadata:
      cwe:
        - CWE-352 Cross-Site Request Forgery (CSRF) https://cwe.mitre.org/data/definitions/352.html
      category: error prone
      technology: salesforce
    message: >-
      Having DML operations in Apex class constructor or initializers can
      have unexpected side effects: By just accessing a page, the DML statements
      would be executed and the database would be modified. Just querying the
      database is permitted.
    patterns:
      - pattern-inside: static {...}
      - pattern-either:
        - pattern: |
            insert $DATA;
        - pattern: |
            update $DATA;
        - pattern: |
            upsert $DATA;
        - pattern: |
            delete $DATA;
    paths:
      exclude:
        - "*Test*"
        - "*test*"
